<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Core -->
  <meta charset="utf-8" />
  <title>Life RPG â€” PWA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="description" content="Offline-first life RPG combining tasks, habits, quests, and calendar into a single points-driven daily loop." />
  <meta name="theme-color" content="#0b0d10" />

  <!-- iOS / PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Life RPG" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="format-detection" content="telephone=no" />

  <!-- PWA Manifest & Icons -->
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <!-- CSS -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Prevent flash of unstyled content on slow CSS -->
  <style>
    /* Minimal critical styles to avoid FOUC; full styling in styles.css */
    :root { color-scheme: dark; }
    html, body { height: 100%; margin: 0; padding: 0; background: #0b0d10; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; color: #e8ecf1; }
    .skip-link { position: absolute; left: -9999px; top: auto; width: 1px; height: 1px; overflow: hidden; }
    .skip-link:focus { left: 12px; top: 12px; width: auto; height: auto; background: #1b1f24; color: #fff; padding: 8px 12px; border-radius: 8px; z-index: 10000; }
    .app { display: grid; grid-template-rows: auto 1fr auto; min-height: 100dvh; overflow-x: hidden; }
    .app-header { position: sticky; top: 0; z-index: 20; background: linear-gradient(180deg,#0b0d10,rgba(11,13,16,0.9)); backdrop-filter: saturate(140%) blur(6px); border-bottom: 1px solid rgba(255,255,255,0.05); }
    .kpi-bar { display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; padding: 16px 16px 8px; }
    .kpi { display: flex; gap: 16px; align-items: baseline; }
    .kpi .today-points { font-size: clamp(28px, 6vw, 44px); font-weight: 800; letter-spacing: -0.02em; }
    .kpi .label { font-size: 12px; opacity: 0.7; }
    .streak-chip { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; background: #10151b; border: 1px solid rgba(255,255,255,0.06); font-weight: 600; }
    .streak-chip svg { width: 16px; height: 16px; }
    .progress { padding: 0 16px 12px; }
    .progress-track { height: 10px; width: 100%; background: #12171e; border-radius: 999px; overflow: hidden; }
    .progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg,#2bd576,#19a957); transition: width 320ms ease; }
    main#view { padding: 8px 12px 76px; }
    .tabbar { position: sticky; bottom: 0; z-index: 30; background: rgba(11,13,16,0.98); border-top: 1px solid rgba(255,255,255,0.06); display: grid; grid-template-columns: repeat(4,1fr); align-items: center; height: 64px; }
    .tabbar a { display: inline-flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; text-decoration: none; color: #b7c2cf; font-size: 11px; padding-top: 6px; }
    .tabbar a.active { color: #ffffff; }
    .tabbar svg { width: 22px; height: 22px; }
    .fab { position: fixed; right: 16px; bottom: 84px; z-index: 40; width: 56px; height: 56px; border-radius: 999px; border: none; background: #2f6bed; color: white; display: inline-grid; place-items: center; box-shadow: 0 10px 24px rgba(47,107,237,0.4); }
    .fab:active { transform: translateY(1px); }
    .sheet-root, .modal-root { position: fixed; left: 0; right: 0; bottom: 0; top: 0; pointer-events: none; z-index: 50; }
    .toast-root { position: fixed; left: 50%; transform: translateX(-50%); bottom: 72px; z-index: 60; pointer-events: none; }
    .loading { display: grid; place-items: center; height: 40vh; opacity: 0.7; }
    .skeleton { background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.12), rgba(255,255,255,0.06)); background-size: 200% 100%; animation: shimmer 1.1s infinite; border-radius: 8px; }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
  </style>

  <!-- Progressive Enhancement: prefer-reduced-motion -->
  <style>
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 1ms !important; transition-duration: 1ms !important; }
    }
  </style>

  <!-- No script fallback -->
  <noscript>
    <style> .app, .fab, .tabbar, .app-header { display: none !important; } body { padding: 24px; } </style>
  </noscript>
</head>

<body>
  <a class="skip-link" href="#view">Skip to content</a>

  <div id="app" class="app" data-theme="dark">
    <!-- Header / KPI -->
    <header id="app-header" class="app-header" role="banner">
      <div class="kpi-bar" aria-live="polite">
        <div class="kpi">
          <div>
            <div class="label">Today</div>
            <div class="today-points" id="kpi-today-points">0</div>
          </div>
          <div>
            <div class="label">Goal</div>
            <div id="kpi-goal">100</div>
          </div>
        </div>
        <div class="streak-chip" id="streak-chip" title="Current streak">
          <!-- Flame icon -->
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 3c1 4-3 5-3 8 0 2 2 4 4 4 2.5 0 4.5-2 4.5-4.5 0-3-2-4-2-6 0-1 .5-1.5 .5-1.5S17 4 17 6c0 2-1 3-1 5 0 3 2 5 2 5s-2 3-6 3-6-3-6-6c0-4 3-6 6-10Z" fill="currentColor" opacity=".9"/>
          </svg>
          <span id="streak-count">0</span>
        </div>
      </div>
      <div class="progress" aria-label="Daily progress">
        <div class="progress-track" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
          <div class="progress-fill" id="progress-fill" style="width:0%"></div>
        </div>
      </div>
    </header>

    <!-- Main View -->
    <main id="view" role="main" tabindex="-1" aria-live="polite">
      <!-- Initial skeleton; app.js replaces this with the active tab render -->
      <section class="loading">
        <div style="display:grid; gap:12px; width:min(680px, 92vw);">
          <div class="skeleton" style="height:48px;"></div>
          <div class="skeleton" style="height:120px;"></div>
          <div class="skeleton" style="height:200px;"></div>
        </div>
      </section>
    </main>

    <!-- Bottom Tabbar -->
    <nav id="tabbar" class="tabbar" role="navigation" aria-label="Primary">
      <a href="#home" data-tab="home" class="active" aria-label="Home">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 3 3 10v10a1 1 0 0 0 1 1h6v-6h4v6h6a1 1 0 0 0 1-1V10L12 3Z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
        </svg>
        <span>Home</span>
      </a>
      <a href="#calendar" data-tab="calendar" aria-label="Calendar">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <rect x="3" y="4" width="18" height="17" rx="2" stroke="currentColor" stroke-width="1.6"/>
          <path d="M8 2v4M16 2v4M3 9h18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
        <span>Calendar</span>
      </a>
      <a href="#stats" data-tab="stats" aria-label="Stats">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M4 20V9M10 20V4M16 20v-6M22 20H2" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
        <span>Stats</span>
      </a>
      <a href="#settings" data-tab="settings" aria-label="Settings">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="1.6"/>
          <path d="M19.4 15a7.8 7.8 0 0 0 .1-2 7.8 7.8 0 0 0-.1-2l2-1.6a.9.9 0 0 0 .2-1.1l-1.9-3.2a.9.9 0 0 0-1.1-.4l-2.3.9a8.1 8.1 0 0 0-1.7-1L12 1.6a1 1 0 0 0-1 0l-1.6.9a8.1 8.1 0 0 0-1.7 1l-2.3-.9a.9.9 0 0 0-1.1.4L1.4 6.2a.9.9 0 0 0 .2 1.1L3.6 9a7.8 7.8 0 0 0-.1 2 7.8 7.8 0 0 0 .1 2l-2 1.6a.9.9 0 0 0-.2 1.1l1.9 3.2c.2.4.6.6 1.1.4l2.3-.9c.5.4 1.1.7 1.7 1l1.6.9a1 1 0 0 0 1 0l1.6-.9c.6-.3 1.2-.6 1.7-1l2.3.9c.5.2.9 0 1.1-.4l1.9-3.2a.9.9 0 0 0-.2-1.1L19.4 15Z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
        </svg>
        <span>Settings</span>
      </a>
    </nav>

    <!-- Floating Action Button -->
    <button id="fab" class="fab" type="button" aria-label="Add">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true" role="img">
        <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>
  </div>

  <!-- Portals / Overlays -->
  <div id="sheet-root" class="sheet-root" aria-hidden="true"></div>
  <div id="modal-root" class="modal-root" aria-hidden="true"></div>
  <div id="toast-root" class="toast-root" aria-live="polite" aria-atomic="true"></div>

  <!-- No-JS fallback -->
  <noscript>
    <p>This app requires JavaScript to run.</p>
  </noscript>

  <!-- App JS -->
  <script src="app.js" defer></script>

  <!-- SW Registration -->
  <script>
    (function() {
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('./sw.js').catch(function(err) {
            console.warn('SW registration failed:', err);
          });
        });
      }
      // Basic hash routing fallback: default to #home
      if (!location.hash) location.replace('#home');
    })();
  </script>
</body>
</html>
